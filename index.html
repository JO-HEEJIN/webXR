<!DOCTYPE html>
<html>
<head>
    <title>WebXR with Babylon.js</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #renderCanvas { width: 100%; height: 100%; touch-action: none; }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            var canvas = document.getElementById('renderCanvas');
            var engine = new BABYLON.Engine(canvas, true);
            var createScene = async function () {
                var scene = new BABYLON.Scene(engine);
                var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2,  Math.PI / 2, 5, BABYLON.Vector3.Zero(), scene);
                camera.attachControl(canvas, true);
                camera.inputs.attached.mousewheel.detachControl(canvas);

                var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

                var xrHelper = await scene.createDefaultXRExperienceAsync();

                var box = BABYLON.MeshBuilder.CreateBox("box", {}, scene);
                box.setEnabled(false);

                var hitTestObservable = xrHelper.baseExperience.featuresManager.enableFeature(BABYLON.WebXRHitTest, 'latest', {hitTestType: BABYLON.WebXRHitTest.HIT_TEST_TYPE_PLANE});
                hitTestObservable.onHitTestResultObservable.add((results) => {
                    if (results.length) {
                        var hit = results[0];
                        box.position = hit.position;
                        box.setEnabled(true);
                    }
                });

                return scene;
            };
            createScene().then(function(scene) {
                engine.runRenderLoop(function () {
                    if (scene) {
                        scene.render();
                    }
                });
                window.addEventListener('resize', function () {
                    engine.resize();
                });
            });
        });
    </script>
</body>
</html>
